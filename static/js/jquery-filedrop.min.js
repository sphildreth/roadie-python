!function(e){function r(){}jQuery.event.props.push("dataTransfer");var t={fallback_id:"",url:"",refresh:1e3,paramname:"userfile",requestType:"POST",allowedfileextensions:[],allowedfiletypes:[],maxfiles:25,maxfilesize:1,queuefiles:0,queuewait:200,data:{},headers:{},drop:r,dragStart:r,dragEnter:r,dragOver:r,dragLeave:r,docEnter:r,docOver:r,docLeave:r,beforeEach:r,afterAll:r,rename:r,error:function(e){alert(e)},uploadStarted:r,uploadFinished:r,progressUpdated:r,globalProgressUpdated:r,speedUpdated:r},n=["BrowserNotSupported","TooManyFiles","FileTooLarge","FileTypeNotAllowed","NotFound","NotReadable","AbortError","ReadError","FileExtensionNotAllowed"];e.fn.filedrop=function(r){function a(e){if(R.drop.call(this,e)===!1)return!1;if(e.dataTransfer)return x=e.dataTransfer.files,null===x||void 0===x||0===x.length?(R.error(n[0]),!1):(E=x.length,l(),e.preventDefault(),!1)}function o(r,t,n,a){var o="--",i="\r\n",s="",l=R.paramname;if(R.data){var u=e.param(R.data).replace(/\+/g,"%20").split(/&/);e.each(u,function(){var e=this.split("=",2),r=decodeURIComponent(e[0]),t=decodeURIComponent(e[1]);2===e.length&&(s+=o,s+=a,s+=i,s+='Content-Disposition: form-data; name="'+r+'"',s+=i,s+=i,s+=t,s+=i)})}return jQuery.isFunction(l)&&(l=l(r)),s+=o,s+=a,s+=i,s+='Content-Disposition: form-data; name="'+(l||"")+'"',s+='; filename="'+encodeURIComponent(r)+'"',s+=i,s+="Content-Type: "+n,s+=i,s+=i,s+=t,s+=i,s+=o,s+=a,s+=o,s+=i}function i(e){if(e.lengthComputable){var r=Math.round(100*e.loaded/e.total);if(this.currentProgress!==r){this.currentProgress=r,R.progressUpdated(this.index,this.file,this.currentProgress),A[this.global_progress_index]=this.currentProgress,s();var t=(new Date).getTime(),n=t-this.currentStart;if(n>=R.refresh){var a=e.loaded-this.startData,o=a/n;R.speedUpdated(this.index,this.file,o),this.startData=e.loaded,this.currentStart=t}}}}function s(){if(0!==A.length){var e,r=0;for(e in A)A.hasOwnProperty(e)&&(r+=A[e]);R.globalProgressUpdated(Math.round(r/A.length))}}function l(){if(b=!1,!x)return R.error(n[0]),!1;if(R.allowedfiletypes.push&&R.allowedfiletypes.length)for(var r=x.length;r--;)if(!x[r].type||e.inArray(x[r].type,R.allowedfiletypes)<0)return R.error(n[3],x[r]),!1;if(R.allowedfileextensions.push&&R.allowedfileextensions.length)for(var r=x.length;r--;){var t=!1;for(v=0;v<R.allowedfileextensions.length;v++)x[r].name.substr(x[r].name.length-R.allowedfileextensions[v].length).toLowerCase()==R.allowedfileextensions[v].toLowerCase()&&(t=!0);if(!t)return R.error(n[8],x[r]),!1}var a=0,l=0;if(E>R.maxfiles&&0===R.queuefiles)return R.error(n[1]),!1;for(var p=[],h=[],g=[],v=0;E>v;v++)p.push(v);var m=function(e){setTimeout(y,e)},y=function(){var e;if(b)return!1;if(R.queuefiles>0&&h.length>=R.queuefiles)return m(R.queuewait);e=p[0],p.splice(0,1),h.push(e);try{if(f(x[e])!==!1){if(e===E)return;var r=new FileReader,t=1048576*R.maxfilesize;if(r.index=e,x[e].size>t)return R.error(n[2],x[e],e),h.forEach(function(r,t){r===e&&h.splice(t,1)}),l++,!0;r.onerror=function(e){switch(e.target.error.code){case e.target.error.NOT_FOUND_ERR:return R.error(n[4]),!1;case e.target.error.NOT_READABLE_ERR:return R.error(n[5]),!1;case e.target.error.ABORT_ERR:return R.error(n[6]),!1;default:return R.error(n[7]),!1}},r.onloadend=R.beforeSend?function(r){R.beforeSend(x[e],e,function(){w(r)})}:w,r.readAsDataURL(x[e])}else l++}catch(a){return h.forEach(function(r,t){r===e&&h.splice(t,1)}),R.error(n[0]),!1}p.length>0&&y()},w=function(r){var t=(r.srcElement||r.target).index;void 0===r.target.index&&(r.target.index=u(r.total));var n,f=new XMLHttpRequest,p=f.upload,v=x[r.target.index],m=r.target.index,y=(new Date).getTime(),w="------multipartformboundary"+(new Date).getTime(),T=A.length,D=d(v.name),q=v.type;R.withCredentials&&(f.withCredentials=R.withCredentials);var L=atob(r.target.result.split(",")[1]);n="string"==typeof D?o(D,L,q,w):o(v.name,L,q,w),p.index=m,p.file=v,p.downloadStartTime=y,p.currentStart=y,p.currentProgress=0,p.global_progress_index=T,p.startData=0,p.addEventListener("progress",i,!1),jQuery.isFunction(R.url)?f.open(R.requestType,R.url(),!0):f.open(R.requestType,R.url,!0),f.setRequestHeader("content-type","multipart/form-data; boundary="+w),f.setRequestHeader("X-Requested-With","XMLHttpRequest"),e.each(R.headers,function(e,r){f.setRequestHeader(e,r)}),f.sendAsBinary||(f.sendAsBinary=function(e){function r(e){return 255&e.charCodeAt(0)}var t=Array.prototype.map.call(e,r),n=new Uint8Array(t);this.send(n.buffer)}),f.sendAsBinary(n),A[T]=0,s(),R.uploadStarted(m,v,E),f.onload=function(){var e=null;if(f.responseText)try{e=jQuery.parseJSON(f.responseText)}catch(r){e=f.responseText}var n=(new Date).getTime(),o=n-y,i=R.uploadFinished(m,v,e,o,f);a++,h.forEach(function(e,r){e===t&&h.splice(r,1)}),g.push(t),A[T]=100,s(),a===E-l&&c(),i===!1&&(b=!0),(f.status<200||f.status>299)&&R.error(f.statusText,v,t,f.status)}};y()}function u(e){for(var r=0;E>r;r++)if(x[r].size===e)return r;return void 0}function d(e){return R.rename(e)}function f(e){return R.beforeEach(e)}function c(){return R.afterAll()}function p(e){clearTimeout(T),e.preventDefault(),R.dragEnter.call(this,e)}function h(e){clearTimeout(T),e.preventDefault(),R.docOver.call(this,e),R.dragOver.call(this,e)}function g(e){clearTimeout(T),R.dragLeave.call(this,e),e.stopPropagation()}function v(e){return e.preventDefault(),R.docLeave.call(this,e),!1}function m(e){return clearTimeout(T),e.preventDefault(),R.docEnter.call(this,e),!1}function y(e){return clearTimeout(T),e.preventDefault(),R.docOver.call(this,e),!1}function w(e){T=setTimeout(function(r){return function(){R.docLeave.call(r,e)}}(this),200)}var T,x,R=e.extend({},t,r),A=[],b=!1,E=0;return e("#"+R.fallback_id).css({display:"none",width:0,height:0}),this.on("drop",a).on("dragstart",R.dragStart).on("dragenter",p).on("dragover",h).on("dragleave",g),e(document).on("drop",v).on("dragenter",m).on("dragover",y).on("dragleave",w),this.on("click",function(r){e("#"+R.fallback_id).trigger(r)}),e("#"+R.fallback_id).change(function(e){R.drop(e),x=e.target.files,E=x.length,l()}),this};try{if(XMLHttpRequest.prototype.sendAsBinary)return;XMLHttpRequest.prototype.sendAsBinary=function(e){function r(e){return 255&e.charCodeAt(0)}var t=Array.prototype.map.call(e,r),n=new Uint8Array(t);this.send("ArrayBufferView"in window?n:n.buffer)}}catch(a){}}(jQuery);