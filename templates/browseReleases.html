{% extends "layout.html" %}
{% block title %}Browsing : Releases{% endblock %}
{% block header_content %}
{% endblock %}
{% block body_content %}
<div class="browse-release-container">
    <table id="browseReleasesGrid"></table>
</div>
{% endblock %}
{% block script_content %}
<script type="text/javascript">
    $(function() {
        $('#browseReleasesGrid').bootstrapTable({
            ajax: function(params) {
                sort = params.data.sort ? params.data.sort : "";
                order = params.data.order ? params.data.order : "";
                search = params.data.search ? params.data.search : "";
                $.ajax({
                    url: '/api/v1.0/releases?sort='+ sort + '&order=' + order + '&limit=' + params.data.limit + '&skip=' + params.data.offset + '&inc=None&filter=' + search,
                    success: function(data) {
                        if(data.message === "OK") {
                            params.success({
                                total: data.total,
                                rows: data.rows
                            });
                            params.complete();
                        }
                    },
                    error:function(jq, st, error){
                        roadieLibrary.showErrorMessage(error);
                    }
                });
            },
            idField: 'id',
            search: true,
            showExport: true,
            exportDataType: 'all',
            pageSize: 50,
            pagination: true,
            sidePagination: 'server',
            detailView: true,
            detailFormatter: function(index,row) {
               var html = [];
                $.each(row, function (key, value) {
                    html.push('<p><b>' + key + ':</b> ' + value + '</p>');
                });
                return html.join('');
            },
            sortName: "release.createdDate",
            sortOrder: "desc",
            columns: [
                { field: 'ReleaseId', visible: false },
                { field: 'title', title: 'Title', sortable: true, formatter: function(value,row,index) {
                    var releaseId = row.id;
                    var title = row.title;
                    var rating = row.rating;
                    var thumbnail = row.thumbnailUrl;
                    return '<a href="/release/' + releaseId + '"><div class="thumbnail-container pull-left"><img class="release-thumb" src="' + thumbnail + '" alt="' + title + '" /></div><span class="label label-default">' + title + '</span></a>';
                }},
                { field: 'release.rating', sortable: true, title: 'Rating' },
                { field: 'releaseYear', sortName: 'releaseDate', sortable: true, title: 'Year' },
                { field: 'release.createdDate', sortable: true, title: 'Created Date' },
                { field: 'release.lastUpdated', sortable: true, title: 'Last Updated' },
                { field: 'trackCount', sortable: true, title: '# Tracks' },
                { field: 'artist.name', sortable: true, title: 'Artist', formatter: function(value,row, index) {
                    var thumbnail = "/images/artist/thumbnail/" + row.artistId;
                    return '<a href="/artist/' + row.artistId + '"><div class="thumbnail-container pull-left"><img class="release-thumb" src="' + thumbnail + '" alt="' + row['artist.name']  + '" /></div><span class="label label-default">' + row['artist.name'] + '</span></a>';
                }},
                { field: 'releasePlayedCount', title: '# Plays' }
            ]
        });
    });

</script>
{% endblock %}