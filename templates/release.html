{% extends "layout.html" %}
{% block title %}{{ release.Title }}{% endblock %}
{% block header_content %}
{% endblock %}
{% block body_content %}
    <div class="release-detail-container" data-release-id="{{ release.id }}">
        <div class="btn-toolbar edit-toolbar" role="toolbar">
            <div class="btn-group">
              <button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                <i class="fa fa-play"></i> Play <span class="caret"></span>
              </button>
              <ul class="dropdown-menu">
                <li><a href="#">Play All</a></li>
              </ul>
            </div>
            {% if current_user.is_authenticated() and current_user.has_role("Admin") %}
              <div class="btn-group">
                <a href="/admin/release/edit/?id={{ release.id }}&url=/release/{{ release.id }}" type="button" class="btn btn-warning"><i class="fa fa-edit"></i> Edit</a>
                <button id="delete-release" class="btn btn-warning"><i class="fa fa-trash-o"></i> Delete</button>
             </div>
            {% endif %}
        </div>
        <div class="row title bordered">
            <img class="thumb pull-left" src="/images/release/thumbnail/{{ release.id }}" alt="{{ release.Title }}" />
            <span class="artist-info">
                <img class="thumb pull-left" src="/images/artist/thumbnail/{{ release.Artist.id }}" alt="{{ release.Artist.Name }}" />
                <h5><a title="View Artist" href="/artist/{{ release.Artist.id }}"><span class="label label-info">{{ release.Artist.Name }}</span></a></h5>
            </span>
            <h2><span class="label label-default">{{ release.Title }}</span></h2>
        </div>
        <div class="row bordered">
            <div class="col-md-6">
                <h4><span class="label label-primary">Profile</span></h4>
                <p>{{ release.Profile }}</p>
            </div>
            <div class="col-md-6">
                {% for image in release.Images %}
                    <div class="col-md-3">
                        <a href="javascript:void();"
                           data-title="{{ image.element.filename }}"
                           data-url="/images/release/{{ release.id}}/{{ image.element.grid_id }}/2048/2048"
                           target="_blank" class="thumbnail">
                            <img data-image-id="{{ image.element.grid_id }}" data-toggle="context" data-target="#context-menu-{{ image.element.grid_id }}" src="/images/release/{{ release.id}}/{{ image.element.grid_id }}/512/512" alt="Image" />
                        </a>
                    </div>
                    <div id="context-menu-{{ image.element.grid_id }}" data-image-id="{{ image.element.grid_id }}" class="context-menu">
                        <ul class="dropdown-menu" role="menu">
                        <li><a class="setReleaseImage" tabindex="-1"><i class="fa fa-file-image-o"></i> Set as Release Image</a></li>
                        </ul>
                    </div>
                {% endfor %}
            </div>
        </div>
        <div class="row details bordered">
            <div class="col-md-3">
                <div>
                    <h4><span class="label label-primary">Release Date</span></h4>
                    <span class="label label-default">{{ release.ReleaseDate }}</span>
                </div>
                <div>
                    <h4><span class="label label-primary">MusicBrainz Id</span></h4>
                    <span class="label label-default">{{ release.MusicBrainzId }}</span>
                </div>
            </div>
            <div class="col-md-3">
                <div>
                    <h4><span class="label label-primary">Track Count</span></h4>
                    <span class="label label-default">{{ release.TrackCount }}</span>
                </div>
                <div>
                    <h4><span class="label label-primary">Disc Count</span></h4>
                    <span class="label label-default">{{ release.DiscCount }}</span>
                </div>
            </div>
            <div class="col-md-3">
                <div>
                    <h4><span class="label label-primary">Virtual</span></h4>
                    <span class="label label-default">{{ release.IsVirtual }}</span>
                </div>
            </div>
            <div class="col-md-3">
               <div>
                    <h4><span class="label label-primary">Total Track Time</span></h4>
                    <span class="label label-default">{{ release.Tracks|sum(attribute='Track.Length')|format_timedelta("{hours2}:{minutes2}:{seconds2}")  }}</span>
                </div>
               <div>
                    <h4><span class="label label-primary">Quality</span></h4>
                    <span class="label label-default">{{ release.Quality.Name }}</span>
                </div>
            </div>
        </div>
        <div class="row lists bordered">
            <div class="col-md-3">
                <h4><span class="label label-primary">Alternate Names</span></h4>
                <ul>
                    {% for alternateName in release.AlternateNames %}
                    <li><span class="label label-default">{{ alternateName }}</span></li>
                    {% endfor %}
                </ul>
            </div>
            <div class="col-md-3">
                <div>
                    <h4><span class="label label-primary">Genres</span></h4>
                    <ul>
                        {% for genre in release.Genre %}
                        <li><span class="label label-default">{{ genre }}</span></li>
                        {% endfor %}
                    </ul>
                </div>
                <div>
                    <h4><span class="label label-primary">Labels</span></h4>
                    <ul>
                        {% for label in release.Labels %}
                        <li><span class="label label-default">{{ label.Name }}</span></li>
                        {% endfor %}
                    </ul>
                </div>
            </div>
            <div class="col-md-3">
                <h4><span class="label label-primary">Tags</span></h4>
                <ul>
                    {% for tag in release.Tags %}
                    <li><span class="label label-default">{{ tag }}</span></li>
                    {% endfor %}
                </ul>
            </div>
            <div class="col-md-3">
                <div>
                    <h4><span class="label label-primary">Library Folders</span></h4>
                    {% for group in release.Tracks.Track|map('path', 'FilePath') %}
                    <ul class="folders">
                        <li>
                            <span class="length label label-info">{{ group.grouper }}</span>
                        </li>
                    </ul>
                    {% endfor %}
                </div>
                <div>
                    <h4><span class="label label-primary">Urls</span></h4>
                    <ul>
                        {% for url in release.Urls %}
                        <li><a href="{{ url.Url }}" target="_blank"><span class="label label-default">{{ url.Title }}</span></a></li>
                        {% endfor %}
                    </ul>
                </div>
            </div>
        </div>
        <div class="row tracks bordered">
            {% for track in release.Tracks|sort(attribute='TrackNumber') %}
                <div class="row">
                    <div class="col-xs-1 col-sm-1 col-md-1">
                        <span class="trackNumber label label-primary">{{ '%02d' % track.TrackNumber }}</span>
                    </div>
                    <div class="col-xs-8 col-sm-8 col-md-9">
                        <span data-toggle="tooltip" data-placement="top" title="{{ track.Track.Title }}" class="title label label-default">{{ track.Track.Title }}</span>
                    </div>
                    <div class="col-xs-2 col-sm-2 col-md-2">
                        <span class="length label label-info">{{ track.Track.Length|format_timedelta("{hours2}:{minutes2}:{seconds2}") }}</span>
                    </div>
                </div>
            {% endfor %}
        </div>
        <div class="meta pull-right">
            <p><span class="label label-info">Last Modified: {{ release.LastUpdated }}</span></p>
        </div>
    </div>
{% endblock %}
{% block script_content %}
    <script type="text/javascript">
    var releaseId = '{{ release.id }}';
    $(function() {
        $("#delete-release").on("click", function(e) {
            bootbox.confirm("Continue To Delete Release?", function(result) {
                if(result) {
                    var $t = $(this);
                    $.ajax({
                        type: 'POST',
                        url: '/release/delete/' + releaseId,
                        contentType: "application/javascript",
                        success: function(data) {
                            if(data.message == "OK") {
                                window.location.href = '/artist/{{ release.Artist.id }}';
                            }
                        },
                        error:function(jq, st, error){
                            alert(error);
                        }
                    });
                }
            });
        });
    });
    </script>
{% endblock %}
