{% extends "layout.html" %}
{% block title %}{{ artist.Name }}{% endblock %}
{% block header_content %}
{% endblock %}
{% block body_content %}
    <div class="artist-detail-container" data-artist-id="{{ artist.id }}">
        <div class="release-counts-container pull-right">
            <span class="release-count">Releases: <span class="badge" data-toggle="tooltip" data-placement="bottom" title="Total Releases of Artist">{{ counts.releases }}</span></span>
            <span class="track-count">Tracks: <span class="badge" data-toggle="tooltip" data-placement="bottom" title="Total Tracks of Artist">{{ counts.tracks }}</span></span>
            <span class="length-total">Time: <span class="badge" data-toggle="tooltip" data-placement="bottom" title="Total Playtime of Artist">{{ counts.length|format_timedelta("{days}:{hours2}:{minutes2}:{seconds2}") }}</span></span>
        </div>
        <div class="btn-toolbar edit-toolbar" role="toolbar">
            <div class="btn-group">
              <button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                <i class="fa fa-play"></i> Play <span class="caret"></span>
              </button>
              <ul class="dropdown-menu">
                <li><a href="#">Play All</a></li>
                <li><a href="#">Play Top Rated</a></li>
                <li><a href="#">Play Most Popular</a></li>
              </ul>
            </div>
            {% if current_user.is_authenticated() and current_user.has_role("Admin") %}
              <div class="btn-group">
                <a href="/admin/artist/edit/?id={{ artist.id }}&url=/artist/{{ artist.id }}" type="button" class="btn btn-warning"><i class="fa fa-edit"></i> Edit</a>
                <button id="delete-artist" class="btn btn-warning"><i class="fa fa-trash-o"></i> Delete</button>
             </div>
            {% endif %}
        </div>
        <div class="row title bordered">
            <div class="thumbnail-container pull-left">
                <img class="thumb " src="/images/artist/thumbnail/{{ artist.id }}" alt="{{ artist.Name }}" />
            </div>
            <h2><span class="label label-default">{{ artist.Name }}</span></h2>
        </div>
        <div class="row bordered">
            <div class="col-md-6">
                <h4><span class="label label-primary">Profile</span></h4>
                <p>{{ artist.Profile }}</p>
            </div>
            <div class="col-md-6">
                {% for image in artist.Images %}
                    <div class="col-md-3">
                        <a href="javascript:void();"
                           data-title="{{ image.element.filename }}"
                           data-url="/images/artist/{{ artist.id}}/{{ image.element.grid_id }}/2048/2048"
                           target="_blank" class="thumbnail">
                            <img data-image-id="{{ image.element.grid_id }}" data-toggle="context" data-target="#context-menu-{{ image.element.grid_id }}" src="/images/artist/{{ artist.id}}/{{ image.element.grid_id }}/512/512" alt="Image" />
                        </a>
                    </div>
                    <div id="context-menu-{{ image.element.grid_id }}" data-image-id="{{ image.element.grid_id }}" class="context-menu">
                        <ul class="dropdown-menu" role="menu">
                        <li><a class="setArtistImage" tabindex="-1"><i class="fa fa-file-image-o"></i> Set as Artist Image</a></li>
                        </ul>
                    </div>
                {% endfor %}
            </div>
        </div>
        <div class="row details bordered">
            <div class="col-md-3">
                <div>
                    <h4><span class="label label-primary">Sort Name</span></h4>
                    <span class="label label-default">{{ artist.SortName }}</span>
                </div>
                <div>
                    <h4><span class="label label-primary">Real Name</span></h4>
                    <span class="label label-default">{{ artist.RealName }}</span>
                </div>
            </div>
            <div class="col-md-3">
                <div>
                    <h4><span class="label label-primary">Artist Type</span></h4>
                    <span class="label label-default">{{ artist.ArtistType.Name }}</span>
                </div>
                <div>
                    <h4><span class="label label-primary">MusicBrainz Id</span></h4>
                    <span class="label label-default">{{ artist.MusicBrainzId }}</span>
                </div>
            </div>
            <div class="col-md-3">
                <div>
                    <h4><span class="label label-primary">Begin Date</span></h4>
                    <span class="label label-default">{{ artist.BeginDate }}</span>
                </div>
                <div>
                    <h4><span class="label label-primary">End Date</span></h4>
                    <span class="label label-default">{{ artist.EndDate }}</span>
                </div>
            </div>
        </div>
        <div class="row lists bordered">
            <div class="col-md-4">
                <h4><span class="label label-primary">Alternate Names</span></h4>
                <ul>
                    {% for alternateName in artist.AlternateNames %}
                    <li><span class="label label-default">{{ alternateName }}</span></li>
                    {% endfor %}
                </ul>
            </div>
            <div class="col-md-4">
                <h4><span class="label label-primary">Tags</span></h4>
                <ul>
                    {% for tag in artist.Tags %}
                    <li><span class="label label-default">{{ tag }}</span></li>
                    {% endfor %}
                </ul>
            </div>
            <div class="col-md-4">
                <h4><span class="label label-primary">Urls</span></h4>
                <ul>
                    {% for url in artist.Urls %}
                    <li><a href="{{ url.Url }}" target="_blank"><span class="label label-default">{{ url.Title }}</span></a></li>
                    {% endfor %}
                </ul>
            </div>
        </div>
        <div class="release-info-container">
            <div class="row bordered">
            {% for release in releases|sort(attribute='ReleaseDate') %}
                <div class="release pull-left" data-release-id="{{ release.id }}">
                    <img class="pull-left thumb" src="/images/release/thumbnail/{{ release.id}}" alt="{{ release.Title }}" />
                    <a href="/release/{{ release.id }}">
                    <h4><span class="label label-info releasedate">{{ release.ReleaseDate }}</span>
                        <span data-toggle="tooltip" data-placement="top" title="{{ release.Title }}" class="label {{ 'label-default' if release.TrackCount or 0 >= release.Tracks|default('')|length else 'label-danger' }} releasetitle">{{ release.Title }}</span></h4>
                    </a>
                    {% for group in release.Tracks|sort(attribute='TrackNumber')|groupby('ReleaseMediaNumber') %}
                    {% if group.grouper > 0 %}
                    <h5 class="release-cd"><span class="label label-success pull-right">CD {{ group.grouper }}</span></h5>
                    {% endif %}
                    <ul class="tracks">
                        {% for track in group.list %}
                        <li>
                            <span class="trackNumber label label-primary">{{ '%02d' % track.TrackNumber }} </span>
                            <span data-toggle="tooltip" data-placement="top" title="{{ track.Track.Title }}" class="title label label-default">{{ track.Track.Title }}</span>
                            <span class="length label label-info">{{ track.Track.Length|format_timedelta("{hours2}:{minutes2}:{seconds2}") }}</span>
                        </li>
                        {% endfor %}
                    </ul>
                    {% endfor %}
                </div>
            {% endfor %}
            </div>
        </div>
        <div class="meta pull-right">
            <p><span class="label label-info">Last Modified: {{ artist.LastUpdated }}</span></p>
        </div>
    </div>
{% endblock %}
{% block script_content %}
    <script type="text/javascript">
        var artistId = '{{ artist.id }}';
        $(function() {
            $(".artist-detail-container a.thumbnail").on("click", function(e) {
                var $t = $(this);
                bootbox.dialog({
                    title: $t.data("title"),
                    size: 'large',
                    message: '<img src="' + $t.data("url") + '" style="max-width: 100%;" />'
                });
            });
            $("#delete-artist").on("click", function(e) {
                bootbox.confirm("Continue To Delete Artist?", function(result) {
                    if(result) {
                        var $t = $(this);
                        $.ajax({
                            type: 'POST',
                            url: '/artist/delete/' + artistId,
                            contentType: "application/javascript",
                            success: function(data) {
                                if(data.message == "OK") {
                                    window.location.href = '/';
                                }
                            },
                            error:function(jq, st, error){
                                alert(error);
                            }
                        });
                    }
                });
            });
            $("a.setArtistImage").on("click", function(e) {
                var $t = $(this);
                var imageId = $t.parents(".context-menu").data("image-id");
                $.ajax({
                    type: 'POST',
                    url: '/artist/setimage/' + artistId + '/' + imageId,
                    contentType: "application/javascript",
                    success: function(data) {
                        $(".artist-detail-container .title img.thumb").attr("src", "/images/artist/thumbnail/" + artistId + "?" + new Date().getTime());
                    },
                    error:function(jq, st, error){
                        alert(error);
                    }
                });
            });
        });
    </script>
{% endblock %}